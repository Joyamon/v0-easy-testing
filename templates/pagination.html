{% if page_obj.has_other_pages %}
<div class="pagination-container">
    <!-- 分页信息和统计 -->
    <div class="d-flex flex-wrap justify-content-between align-items-center mt-4">
        <div class="pagination-info mb-2 mb-md-0">
            <span class="text-muted">
                显示 {{ page_obj.start_index }} 到 {{ page_obj.end_index }} 条，共 {{ paginator.count }} 条
            </span>
        </div>
        
        <!-- 分页控件 -->
        <nav aria-label="分页导航" class="pagination-nav">
            <ul class="pagination pagination-sm flex-wrap">
                <!-- 首页和上一页按钮 -->
                <li class="page-item {% if not page_obj.has_previous %}disabled{% endif %}">
                    <a class="page-link" href="{% if page_obj.has_previous %}?page=1{% if per_page %}&per_page={{ per_page }}{% endif %}{% for key, value in request.GET.items %}{% if key != 'page' and key != 'per_page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}{% else %}#{% endif %}" aria-label="首页" {% if not page_obj.has_previous %}tabindex="-1" aria-disabled="true"{% endif %}>
                        <span aria-hidden="true">&laquo;&laquo;</span>
                        <span class="visually-hidden">首页</span>
                    </a>
                </li>
                <li class="page-item {% if not page_obj.has_previous %}disabled{% endif %}">
                    <a class="page-link" href="{% if page_obj.has_previous %}?page={{ page_obj.previous_page_number }}{% if per_page %}&per_page={{ per_page }}{% endif %}{% for key, value in request.GET.items %}{% if key != 'page' and key != 'per_page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}{% else %}#{% endif %}" aria-label="上一页" {% if not page_obj.has_previous %}tabindex="-1" aria-disabled="true"{% endif %}>
                        <span aria-hidden="true">&laquo;</span>
                        <span class="visually-hidden">上一页</span>
                    </a>
                </li>

                <!-- 页码显示逻辑优化 -->
                {% if paginator.num_pages <= 7 %}
                    <!-- 如果总页数小于等于7，显示所有页码 -->
                    {% for i in paginator.page_range %}
                        <li class="page-item {% if page_obj.number == i %}active{% endif %}">
                            <a class="page-link" href="{% if page_obj.number != i %}?page={{ i }}{% if per_page %}&per_page={{ per_page }}{% endif %}{% for key, value in request.GET.items %}{% if key != 'page' and key != 'per_page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}{% else %}#{% endif %}" {% if page_obj.number == i %}aria-current="page"{% endif %}>
                                {{ i }}
                            </a>
                        </li>
                    {% endfor %}
                {% else %}
                    <!-- 如果总页数大于7，使用更智��的页码显示逻辑 -->
                    {% if page_obj.number <= 4 %}
                        <!-- 当前页靠近开始 -->
                        {% for i in "12345"|make_list %}
                            <li class="page-item {% if page_obj.number == i|add:"0" %}active{% endif %}">
                                <a class="page-link" href="{% if page_obj.number != i|add:"0" %}?page={{ i }}{% if per_page %}&per_page={{ per_page }}{% endif %}{% for key, value in request.GET.items %}{% if key != 'page' and key != 'per_page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}{% else %}#{% endif %}" {% if page_obj.number == i|add:"0" %}aria-current="page"{% endif %}>
                                    {{ i }}
                                </a>
                            </li>
                        {% endfor %}
                        <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1" aria-disabled="true">...</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ paginator.num_pages }}{% if per_page %}&per_page={{ per_page }}{% endif %}{% for key, value in request.GET.items %}{% if key != 'page' and key != 'per_page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                                {{ paginator.num_pages }}
                            </a>
                        </li>
                    {% elif page_obj.number >= paginator.num_pages|add:"-3" %}
                        <!-- 当前页靠近结束 -->
                        <li class="page-item">
                            <a class="page-link" href="?page=1{% if per_page %}&per_page={{ per_page }}{% endif %}{% for key, value in request.GET.items %}{% if key != 'page' and key != 'per_page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                                1
                            </a>
                        </li>
                        <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1" aria-disabled="true">...</a>
                        </li>
                        {% with start=paginator.num_pages|add:"-4" %}
                            {% for i in "01234"|make_list %}
                                {% with page_number=start|add:i|add:"0" %}
                                    <li class="page-item {% if page_obj.number == page_number %}active{% endif %}">
                                        <a class="page-link" href="{% if page_obj.number != page_number %}?page={{ page_number }}{% if per_page %}&per_page={{ per_page }}{% endif %}{% for key, value in request.GET.items %}{% if key != 'page' and key != 'per_page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}{% else %}#{% endif %}" {% if page_obj.number == page_number %}aria-current="page"{% endif %}>
                                            {{ page_number }}
                                        </a>
                                    </li>
                                {% endwith %}
                            {% endfor %}
                        {% endwith %}
                    {% else %}
                        <!-- 当前页在中间 -->
                        <li class="page-item">
                            <a class="page-link" href="?page=1{% if per_page %}&per_page={{ per_page }}{% endif %}{% for key, value in request.GET.items %}{% if key != 'page' and key != 'per_page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                                1
                            </a>
                        </li>
                        <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1" aria-disabled="true">...</a>
                        </li>
                        {% with start=page_obj.number|add:"-1" %}
                            {% for i in "012"|make_list %}
                                {% with page_number=start|add:i|add:"0" %}
                                    <li class="page-item {% if page_obj.number == page_number %}active{% endif %}">
                                        <a class="page-link" href="{% if page_obj.number != page_number %}?page={{ page_number }}{% if per_page %}&per_page={{ per_page }}{% endif %}{% for key, value in request.GET.items %}{% if key != 'page' and key != 'per_page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}{% else %}#{% endif %}" {% if page_obj.number == page_number %}aria-current="page"{% endif %}>
                                            {{ page_number }}
                                        </a>
                                    </li>
                                {% endwith %}
                            {% endfor %}
                        {% endwith %}
                        <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1" aria-disabled="true">...</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ paginator.num_pages }}{% if per_page %}&per_page={{ per_page }}{% endif %}{% for key, value in request.GET.items %}{% if key != 'page' and key != 'per_page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                                {{ paginator.num_pages }}
                            </a>
                        </li>
                    {% endif %}
                {% endif %}

                <!-- 下一页和末页按钮 -->
                <li class="page-item {% if not page_obj.has_next %}disabled{% endif %}">
                    <a class="page-link" href="{% if page_obj.has_next %}?page={{ page_obj.next_page_number }}{% if per_page %}&per_page={{ per_page }}{% endif %}{% for key, value in request.GET.items %}{% if key != 'page' and key != 'per_page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}{% else %}#{% endif %}" aria-label="下一页" {% if not page_obj.has_next %}tabindex="-1" aria-disabled="true"{% endif %}>
                        <span aria-hidden="true">&raquo;</span>
                        <span class="visually-hidden">下一页</span>
                    </a>
                </li>
                <li class="page-item {% if not page_obj.has_next %}disabled{% endif %}">
                    <a class="page-link" href="{% if page_obj.has_next %}?page={{ paginator.num_pages }}{% if per_page %}&per_page={{ per_page }}{% endif %}{% for key, value in request.GET.items %}{% if key != 'page' and key != 'per_page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}{% else %}#{% endif %}" aria-label="末页" {% if not page_obj.has_next %}tabindex="-1" aria-disabled="true"{% endif %}>
                        <span aria-hidden="true">&raquo;&raquo;</span>
                        <span class="visually-hidden">末页</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>

    <!-- 每页显示记录数选择器 -->
    <div class="d-flex justify-content-end mt-3">
        <div class="per-page-selector d-flex align-items-center">
            <label for="per-page-select" class="me-2 text-muted">每页显示:</label>
            <select id="per-page-select" class="form-select form-select-sm" style="width: auto;" onchange="changePerPage(this.value)" aria-label="选择每页显示记录数">
                <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
                <option value="25" {% if per_page == 25 %}selected{% endif %}>25</option>
                <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
                <option value="100" {% if per_page == 100 %}selected{% endif %}>100</option>
                <option value="200" {% if per_page == 200 %}selected{% endif %}>200</option>
            </select>
        </div>
    </div>
</div>

<!-- 分页功能的JavaScript -->
<script>
    function changePerPage(value) {
        // 获取当前URL参数
        const urlParams = new URLSearchParams(window.location.search);
        
        // 设置每页显示记录数
        urlParams.set('per_page', value);
        
        // 重置到第一页
        urlParams.set('page', 1);
        
        // 重定向到新URL
        window.location.search = urlParams.toString();
    }

    // 添加键盘导航支持
    document.addEventListener('DOMContentLoaded', function() {
        const paginationLinks = document.querySelectorAll('.pagination .page-link');
        
        paginationLinks.forEach(link => {
            link.addEventListener('keydown', function(e) {
                // 按Enter键或空格键激活链接
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    if (!link.classList.contains('disabled') && link.getAttribute('href') !== '#') {
                        window.location.href = link.getAttribute('href');
                    }
                }
            });
        });
    });
</script>

<!-- 添加响应式样式 -->
<style>
    .pagination-container {
        margin-bottom: 2rem;
    }
    
    .pagination-info {
        font-size: 0.875rem;
    }
    
    .pagination .page-link {
        min-width: 2.5rem;
        text-align: center;
        border-radius: 0.2rem;
        margin: 0 0.1rem;
        transition: all 0.2s ease-in-out;
    }
    
    .pagination .page-item.active .page-link {
        font-weight: bold;
    }
    
    .pagination .page-item.disabled .page-link {
        opacity: 0.6;
    }
    
    .per-page-selector {
        font-size: 0.875rem;
    }
    
    .per-page-selector select {
        min-width: 5rem;
    }
    
    /* 响应式调整 */
    @media (max-width: 576px) {
        .pagination .page-link {
            min-width: 2rem;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }
        
        .pagination-info {
            width: 100%;
            text-align: center;
            margin-bottom: 0.5rem;
        }
        
        .pagination-nav {
            width: 100%;
            display: flex;
            justify-content: center;
        }
    }
</style>
{% endif %}
